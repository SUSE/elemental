#
#
# DO NOT EDIT THIS FILE
#
#


search --no-floppy --label --set=root EFI
load_env --file (${root})/grubenv

if [ "${env_block}" ] ; then
  set env_block="(${root})${env_block}"
  export env_block
  load_env -f "${env_block}"
fi

if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   if [ "${env_block}" ] ; then
     save_env -f "${env_block}" next_entry
   fi
   set boot_once=true
else
   set default="0"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    if [ "${env_block}" ] ; then
      save_env -f "${env_block}" saved_entry
    else
      save_env saved_entry
    fi

  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

if [ x$feature_default_font_path = xy ] ; then
   font=unicode
else
    font="/grub2/unicode.pf2"
fi

if loadfont $font ; then
  if [ "${grub_platform}" = "efi" ]; then
    clear
    echo "Please press 't' to show the boot menu on this console"
  fi
  set gfxmode=auto
  load_video
  insmod gfxterm
fi
terminal_input console

for i in gfxterm; do
  if [ x${use_append} = xtrue ]; then
     terminal_output --append $i
  elif terminal_output $i; then
     use_append=true;
  fi
done

insmod part_gpt
insmod gfxmenu
insmod png

if [ -d "($root)/grub2/themes/SLE" ]; then
  loadfont ($root)/grub2/themes/SLE/DejaVuSans-Bold14.pf2
  loadfont ($root)/grub2/themes/SLE/DejaVuSans10.pf2
  loadfont ($root)/grub2/themes/SLE/DejaVuSans12.pf2
  loadfont ($root)/grub2/themes/SLE/ascii.pf2
  set theme=($root)/grub2/themes/SLE/theme.txt
  export theme
fi

set default_timeout=10
if [ ! -z "${timeout}" ]; then
    default_timeout=${timeout}
fi

if [ x${boot_once} = xtrue ]; then
  set timeout=0
elif [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=${default_timeout}
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=${default_timeout}
fi

# each entry must set display_name, linux, initrd and cmdline
for entry in ${entries}; do
    load_env --file (${root})/loader/entries/${entry}

    menuentry "${display_name}" --id "${entry}" {
        load_env --file (${root})/loader/entries/${chosen}
        echo 'Loading Linux...'
        linux "${linux}" ${cmdline}
        echo 'Loading initial ramdisk ...'
        initrd "${initrd}"
    }
done

if [ "${grub_platform}" = "efi" ]; then
  # On EFI systems we can only have graphics *or* serial, so allow the user
  # to switch between the two
  hiddenentry 'Text mode' --hotkey 't' {
    set textmode=true
    terminal_output console
  }
fi
